import"https://app.framerstatic.com/chunk-6LQ2ULTL.mjs";import{a as gt}from"https://app.framerstatic.com/chunk-3NXN5KIO.mjs";import{a as Ct,b as Lt,c as S,d as H}from"https://app.framerstatic.com/chunk-GPNHHDQJ.mjs";import{a as xt}from"https://app.framerstatic.com/chunk-2SM232BY.mjs";import"https://app.framerstatic.com/chunk-QCGKPHEK.mjs";import"https://app.framerstatic.com/chunk-PBX57PVS.mjs";import{a as be,b as Ie,c as Ne,d as It,e as Tt,i as Nt}from"https://app.framerstatic.com/chunk-JHCJJ6RP.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import{e as wt}from"https://app.framerstatic.com/chunk-65AISUCM.mjs";import{a as ft}from"https://app.framerstatic.com/chunk-RTJVYMZ7.mjs";import{a as pt}from"https://app.framerstatic.com/chunk-SZ7C6NIF.mjs";import{a as Se,b as ye,c as X,h,j as it,l as nt,m as ne,o as st}from"https://app.framerstatic.com/chunk-TPLJ226D.mjs";import{a as A}from"https://app.framerstatic.com/chunk-4TRPA3GC.mjs";import"https://app.framerstatic.com/chunk-7GSEC7H4.mjs";import"https://app.framerstatic.com/chunk-D56BGIDP.mjs";import{e as Rt}from"https://app.framerstatic.com/chunk-Q2ODOEJW.mjs";import"https://app.framerstatic.com/chunk-MPBQXYPZ.mjs";import"https://app.framerstatic.com/chunk-4BIZXEWZ.mjs";import{a as lt,i as mt,l as ut,r as ht}from"https://app.framerstatic.com/chunk-WEEMJIYA.mjs";import"https://app.framerstatic.com/chunk-J7PXUI5V.mjs";import{a as rt,i as dt}from"https://app.framerstatic.com/chunk-A2NI6DTS.mjs";import{a as ct}from"https://app.framerstatic.com/chunk-PABHF7FN.mjs";import{Ac as Ye,Nf as Ke,Pf as et,Ub as _e,Wg as E,_e as Je,fe as Xe,m as re,xg as tt}from"https://app.framerstatic.com/chunk-74PBQVLX.mjs";import{h as je}from"https://app.framerstatic.com/chunk-XKBE3MLP.mjs";import"https://app.framerstatic.com/chunk-UJZ2TDVM.mjs";import"https://app.framerstatic.com/chunk-ZKDWXD3R.mjs";import"https://app.framerstatic.com/chunk-V4TANWPK.mjs";import"https://app.framerstatic.com/chunk-FMALV26A.mjs";import"https://app.framerstatic.com/chunk-25W4MKKO.mjs";import"https://app.framerstatic.com/chunk-446SUSTG.mjs";import"https://app.framerstatic.com/chunk-4LM3BF74.mjs";import{a as Re,b as Te}from"https://app.framerstatic.com/chunk-HHZD2RYV.mjs";import{a as P,b as F,c as U,d as at}from"https://app.framerstatic.com/chunk-RLD2AJHB.mjs";import{b as V}from"https://app.framerstatic.com/chunk-7S2RRDYD.mjs";import{a as St}from"https://app.framerstatic.com/chunk-JB6HLEIL.mjs";import"https://app.framerstatic.com/chunk-QFU6OGL3.mjs";import"https://app.framerstatic.com/chunk-7FRK6ZG4.mjs";import{a as vt,b as yt,c as bt}from"https://app.framerstatic.com/chunk-CTKJD4ES.mjs";import"https://app.framerstatic.com/chunk-IFUXZGQQ.mjs";import{Vb as $e,dd as Ze,mg as ie,ri as O}from"https://app.framerstatic.com/chunk-IYQFN35I.mjs";import{Ao as oe,Cg as te,Cn as Qe,Dd as Ae,Id as ee,L as I,La as Fe,Pa as g,Qa as Ue,Tn as qe,U as K,Uf as He,Uh as Be,X as Me,Zh as Ge,_h as We,dc as Oe,fe as Ve,lb as De,qb as T,rb as ze,ua as Ee,za as Pe}from"https://app.framerstatic.com/chunk-DGJIQWYV.mjs";import"https://app.framerstatic.com/chunk-VXJAAVJQ.mjs";import"https://app.framerstatic.com/chunk-5DSVU7DA.mjs";import"https://app.framerstatic.com/chunk-KD4H3DLZ.mjs";import"https://app.framerstatic.com/chunk-4DUBS6C5.mjs";import"https://app.framerstatic.com/chunk-XX4R3RQ6.mjs";import"https://app.framerstatic.com/chunk-UPWEMTSH.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import"https://app.framerstatic.com/chunk-4I3XDWXC.mjs";import"https://app.framerstatic.com/chunk-POQKH4YA.mjs";import"https://app.framerstatic.com/chunk-4AQCMAAQ.mjs";import{e as ot}from"https://app.framerstatic.com/chunk-NKH4EOLD.mjs";import{p as Bt}from"https://app.framerstatic.com/chunk-XVSEP5PH.mjs";import"https://app.framerstatic.com/chunk-AUNF3KWQ.mjs";import{H as u,k as Le,r as xe}from"https://app.framerstatic.com/chunk-2U5FJJFT.mjs";import{b as ke,e as z}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{Pd as Ht,a as Ce,b as D}from"https://app.framerstatic.com/chunk-M7LXWNTO.mjs";import{f as J,i as we}from"https://app.framerstatic.com/chunk-PFHOMMMY.mjs";import{c as ge,d as ve,f as M}from"https://app.framerstatic.com/chunk-72P4HPJP.mjs";import{f as N}from"https://app.framerstatic.com/chunk-WIUFUKXG.mjs";import{ba as Y,d as pe,k as _,t as R,v as fe}from"https://app.framerstatic.com/chunk-GQILM44Y.mjs";import{a as b}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as he}from"https://app.framerstatic.com/chunk-LQILWJHN.mjs";import{e as v,j as i,k as Z,l as me,m as ue}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var $=v(Ce());function Mt(d){return!!d&&d.type==="SandboxUpdate"}function Et(d,e){e.debugRenderingFeatures=d,e.updateAllNodes();for(let[o,n]of Object.entries(d))document.body.classList.toggle(`framerdebug-${o}`,n);let t="debugRenderingFeaturesStyles";if(document.getElementById(t))return;let r=document.createElement("style");r.id=t,r.setAttribute("type","text/css"),r.setAttribute("data-framer-css","true"),r.innerText=`
        .framerdebug-hideCanvas {
            display: none !important;
        }
        .framerdebug-hideShadows * {
            box-shadow: none !important;
            text-shadow: none !important;
        }
        .framerdebug-hideFilters * {
            filter: none !important;
            backdrop-filter: none !important;
        }
        .framerdebug-hideBackgrounds * {
            background: none !important;
        }
        .framerdebug-hideLayers * {
            will-change: unset !important;
        }
        .framerdebug-hideImages img {
            display: none !important;
        }
    `,document.head.appendChild(r)}var Pt=v(Ht());var se=R("DeferredRendering");g.setTaskWrapper(Pt.unstable_batchedUpdates);var Wt=10,Qt=1e3,B=class{constructor(e,t){this.renderCanvas=e;this.onFinishedLoading=t;i(this,"renderingPhase","Unknown");i(this,"isReadyToRender",!1);i(this,"activeScopeId");i(this,"nodeResourceCounters",{});i(this,"groundNodeBatches",[]);i(this,"mutableNodesDeferredRendering",new Set);i(this,"mutableNodesLoadingResources",new Set);i(this,"nodesDeferredRendering",new Set);i(this,"nodesLoadingResources",new Set);i(this,"hasScheduledUpdateCanvas",!1);i(this,"scheduleUpdateCanvas",()=>{this.hasScheduledUpdateCanvas||(this.hasScheduledUpdateCanvas=!0,setTimeout(this.updateCanvas))});i(this,"updateCanvas",()=>{if(this.hasScheduledUpdateCanvas=!1,!this.isReadyToRender)return;if(this.prepareNextBatch(),this.nodesDeferredRendering=new Set(this.mutableNodesDeferredRendering),this.nodesLoadingResources=new Set(this.mutableNodesLoadingResources),this.nodesLoadingResources.size>0||this.nodesDeferredRendering.size>0){g.setPriority(4),this.renderCanvas(this.scheduleUpdateCanvas);return}let t=g.getPriority();if(t>0){g.hasImmediateTasksToRun()||g.setPriority(t-1),this.renderCanvas(this.scheduleUpdateCanvas);return}this.renderingPhase="Normal",se.debug("finished",this.activeScopeId),this.renderCanvas(this.onFinishedLoading)});i(this,"batchUpdateResourceLoading",De(this.scheduleUpdateCanvas,200));i(this,"hasGroundNodes",!1)}prepareNextBatch(){let e=this.groundNodeBatches.shift();if(e!==void 0)for(let t of e)this.mutableNodesDeferredRendering.delete(t),this.mutableNodesLoadingResources.add(t)}groundNodeHasLoadedResources(e){delete this.nodeResourceCounters[e],this.mutableNodesLoadingResources.delete(e),this.nodesDeferredRendering.size===0&&this.batchUpdateResourceLoading()}setReadyToRender(e){this.isReadyToRender!==e&&(this.isReadyToRender=e,this.scheduleUpdateCanvas())}createNodeBatches(e){let t=0,r=[],o=()=>{this.groundNodeBatches.push(r),t=0,r=[]};for(let n of e)t>=Qt&&o(),t+=Ft(n),r.push(n.id);r.length!==0&&o()}setGroundNodes(e,t,r){if(this.activeScopeId!==r&&(this.activeScopeId=r,this.renderingPhase="Deferred",se.debug("switching scope id:",r),this.nodeResourceCounters={},this.groundNodeBatches=[],this.mutableNodesDeferredRendering=new Set,this.mutableNodesLoadingResources=new Set,this.nodesDeferredRendering=new Set,this.nodesLoadingResources=new Set,this.hasGroundNodes=!1),!this.activeScopeId||this.hasGroundNodes)return;if(this.hasGroundNodes=!0,e.length===0)return this.renderingPhase="Normal",se.debug("finished",this.activeScopeId,"groundNodes.length === 0"),this.onFinishedLoading();let o=new Set,n=new Set;for(let s of e){let a=s.id;this.nodeResourceCounters[a]=0,this.mutableNodesDeferredRendering.add(a),t.has(a)?o.add(s):n.add(s)}this.nodesDeferredRendering=new Set(this.mutableNodesDeferredRendering),this.createNodeBatches(o),this.createNodeBatches(n),this.scheduleUpdateCanvas()}shouldTrackResources(e){let t=this.nodesLoadingResources.has(e),r=this.nodesDeferredRendering.has(e);return t&&!r}trackResourceLoading(e,t){if(this.shouldTrackResources(e)){this.nodeResourceCounters[e]++;let o=()=>{this.nodeResourceCounters[e]--,this.checkLoadingState(e)};t().then(o).catch(o)}}checkLoadingState(e){this.shouldTrackResources(e)&&this.nodeResourceCounters[e]===0&&this.groundNodeHasLoadedResources(e)}};function Ft(d){let e=1;d instanceof O&&(e+=Wt);for(let t of d.children??[])e+=Ft(t);return e}var ae=g.getTaskQueue("optimizedImages",{priority:0,maxBatchSize:1,useAnimationFrame:!0});var de=[128,512],qt=4,G=class{constructor(e){this.trackThumbnailLoad=e;i(this,"canRenderCanvasImage",e=>e.includes("framerusercontent.com/"));i(this,"zoom",1);i(this,"imageStates",new Map);i(this,"resizeObserver",new ResizeObserver(e=>{for(let t of e){let r=t.target,o=this.getCurrentImageState(r);if(!o||!o.inViewport)continue;let n=Math.round(t.contentRect.width/this.zoom),s=Math.round(t.contentRect.height/this.zoom);n===0||s===0||o&&o.width===n&&o.height===s||(o.width=n,o.height=s,this.computeNextImage(r,o))}}));i(this,"intersectionObserver",new IntersectionObserver(e=>{for(let t of e){let r=t.target,o=this.getCurrentImageState(r);if(!o||t.boundingClientRect.width===0||t.boundingClientRect.height===0)continue;let n=0,s=0,a=t.isIntersecting||jt(t);a?(n=Math.round(t.boundingClientRect.width/this.zoom),s=Math.round(t.boundingClientRect.height/this.zoom)):(n=o.width,s=o.height),!(o&&o.width===n&&o.height===s&&o.inViewport===a)&&(o.width=n,o.height=s,o.inViewport=a,this.computeNextImage(r,o))}},{rootMargin:"50px",threshold:.05}));i(this,"renderCanvasImage",(e,t,r,o)=>{let n=e.parentElement;if(!n)return;let s=this.getOrCreateImageState(n,e,r),a=!1;a=this.updateImageSource(n,s,0,t,o),a=this.updateImageSource(n,s,1,t)||a,a=this.updateImageSource(n,s,2,t)||a,a&&(s.show=-1,this.computeNextImage(n,s),this.resizeObserver.observe(n),this.intersectionObserver.observe(n))});i(this,"scheduled",!1);i(this,"scheduledRenderings",new Set);i(this,"processRenderMainImage",()=>{this.scheduled=!1;let e=0;for(let t of this.scheduledRenderings){this.scheduledRenderings.delete(t);let r=this.imageStates.get(t);if(r&&(this.renderImage(r),r.show!==0&&(e++,e>qt)))break}this.scheduledRenderings.size>0&&(this.scheduled=!0,ae.add(this.processRenderMainImage))})}getImageSrc(e,t){if(t===-1||t===2)return e;let r=de[t],o=e.match(/(.*?)\/assets\/(\d+)\/([^.]+\.[a-zA-Z\d]+)/);if(o)return`${o[1]}/assets/${r}/${o[3]}`;let n=e.match(/(.*?)\/assets\/([^.]+\.[a-zA-Z\d]+)/);if(n)return`${n[1]}/assets/${r}/${n[2]}`;let s=new URL(e);return s.searchParams.set("scale-down-to",String(r)),s.toString()}setZoom(e){if(this.zoom!==e){this.zoom=e;for(let[t,r]of this.imageStates)this.computeNextImage(t,r)}}getCurrentImageState(e){if(!e.isConnected){this.imageStates.delete(e),this.resizeObserver.unobserve(e),this.intersectionObserver.unobserve(e);return}return this.imageStates.get(e)}getOrCreateImageState(e,t,r){let o=this.imageStates.get(e);return o?(ce(o.images[0]?.img,r,t),ce(o.images[1]?.img,r,t),ce(o.images[2]?.img,r,t),o):(o={width:0,height:0,inViewport:!0,error:!1,show:-1,images:[{img:le(t,r,0),src:"",loaded:!1},{img:le(t,r),src:"",loaded:!1},{img:le(t,r),src:"",loaded:!1}]},this.imageStates.set(e,o),o)}hasSmallerImageLoaded(e,t){return e.images[t-1]?.loaded??!0}loadLargerImage(e,t){for(let r=t+1;r<=2;r++){let o=e.images[t+1];if(o&&!o.loaded&&o.img.src!==o.src){o.img.src=o.src;return}}}updateImageSource(e,t,r,o,n){let s=t.images[r];if(!s)return!1;let a=this.getImageSrc(o,r);if(s.src===a)return!1;s.src=a,s.loaded=!1,s.img.style.visibility!=="hidden"&&(s.img.style.visibility="hidden");let l=!1,m;return r===0&&n&&this.trackThumbnailLoad&&this.trackThumbnailLoad(n,()=>new Promise(f=>{m=f,l?f():setTimeout(f,2e3)})),s.img.onload=()=>{l=!0,m?.(),s.src===a&&(this.loadLargerImage(t,r),s.loaded=s.img.naturalWidth>0,r===2&&(t.error=!s.loaded),this.computeNextImage(e,t))},this.hasSmallerImageLoaded(t,r)&&(s.img.src=a),!0}updateImageVisibility(e,t){let r=e.images[t]?.img.style;if(!r)return;let o=e.show===t?"visible":"hidden";r.visibility!==o&&(r.visibility=o)}computeShow(e){if(e.error)return-1;let t=e.images;if(!e.inViewport)return t[0]?.loaded?0:-1;if(this.zoom>.9)return t[2]?.loaded?2:t[1]?.loaded?1:t[0]?.loaded?0:-1;let r=window.devicePixelRatio??1,o=Math.max(e.width,e.height)*this.zoom*r;return o<=de[0]?t[0]?.loaded?0:-1:o<=de[1]?t[1]?.loaded?1:t[0]?.loaded?0:-1:t[2]?.loaded?2:t[1]?.loaded?1:t[0]?.loaded?0:-1}computeNextImage(e,t){let r=this.computeShow(t);if(t.show===r)return;let o=r<=0||r<t.show;t.show=r,o?this.renderImage(t):this.scheduleRenderMainImage(e)}renderImage(e){this.updateImageVisibility(e,0),this.updateImageVisibility(e,1),this.updateImageVisibility(e,2)}scheduleRenderMainImage(e){this.scheduledRenderings.add(e),this.scheduled||(this.scheduled=!0,ae.add(()=>ae.add(this.processRenderMainImage)))}};function jt(d){let e=d.intersectionRect;return e.width>5||e.height>5}function le(d,e,t){let r=new Image;return r.loading=t===0?"eager":"lazy",Object.assign(r.style,e),r.style.position="absolute",d.appendChild(r),r}function ce(d,e,t){d&&(Object.assign(d.style,e),d.style.position="absolute",d.isConnected||t.appendChild(d))}function Ut(d,e){let r=performance.now(),o=0,n=(...s)=>{performance.now()-r>60?(o=void 0,d(...s)):o=setTimeout(n,60,...s)};return(...s)=>{o&&clearTimeout(o),o=setTimeout(n,e,...s)}}function kt(d){let e=new H;for(let t of d){let r=document.getElementById(We(t.id));r&&e.add(t.id,r,$t(t,r))}return e}function $t(d,e){return d instanceof O?Fe(e):[]}var W=class{constructor(){i(this,"componentLoaderUpdateEmitter",new N);i(this,"componentLoaderUpdateStream",this.componentLoaderUpdateEmitter.newStream);u.isOn("newRpc")||this.componentLoaderUpdateEmitter.emit({type:"update",entities:S(T.entities.values()),deletedEntities:[],modulesRevision:-1,lazyModulesRevision:-1})}emitComponentLoaderUpdateEvent(e){this.componentLoaderUpdateEmitter.emit(e)}async queryData(e){let t=T.dataForIdentifier(e.identifier);b(t,"Missing data definition for identifier");let r=t.annotations?.framerRecordIdKey,o=new He,n={from:{type:"Collection",data:t.class},select:e.fields.map(a=>({type:"Identifier",name:a}))};return e.id&&r&&(n.where={type:"BinaryOperation",operator:"==",left:{type:"Identifier",name:r},right:{type:"LiteralValue",value:e.id}}),{data:await o.query(n,void 0)}}};var Dt=v(Ce()),zt=v(Bt());var w=v(D());function Zt({resolve:d,children:e}){return(0,Dt.useLayoutEffect)(d),(0,w.jsx)(w.Fragment,{children:e})}async function Ot(d,e){let t=document.createElement("div");t.style.visibility="hidden",t.style.position="absolute",t.style.pointerEvents="none",document.body.appendChild(t);let r=(0,zt.createRoot)(t),o=[oe,...(d.root.locales??[]).map(ct)],n=[],s=E.createEmpty();for(let l of e){let m=d.get(l);if(!m)continue;let f=dt(m.html);for(let L of o){let y=m.html;if(L!==oe){let k=ut(f,m.htmlLocalized?.[L],y);if(!k)continue;y=k.type!=="rich-text"?Ye(y,k.value):mt(y,k.value)}let x=m.clone({...qe,textFitViewBoxSize:void 0,widthType:2,heightType:2,width:void 0,height:void 0,id:`${l}-${L}`,html:y});s.insertNode(x,s.root.id),n.push((0,w.jsx)(Tt,{node:x,parent:s.root,parentRenderId:s.root.id,groundNodeId:x.id}))}}await new Promise(l=>{r.render((0,w.jsx)(Zt,{resolve:l,children:n}))});let a=[];for(let l of t.children){let{clientWidth:m,clientHeight:f,id:L}=l,[y,x]=Ge(L).split("-",2);a.push({nodeId:y,localeId:x,width:m,height:f})}return r.unmount(),document.body.removeChild(t),{measurements:a}}var c=R("canvas-sandbox"),_t=(d,e)=>new Promise((t,r)=>{setTimeout(()=>{r(Error(e))},d)}),At=(d,e)=>new Promise(t=>{setTimeout(()=>{c.warn(e),t()},d)}),Q=async(d=1)=>{for(let e=0;e<d;e++)await new Promise(t=>{requestAnimationFrame(t)})},C,q=class{constructor(){i(this,"channelToOpenerFrame");i(this,"renderingStateTracker",Rt.shared());i(this,"renderTarget",K.canvas);i(this,"lastEngineUpdate",0);i(this,"partialTreeReceiver");i(this,"tree",E.createEmpty());i(this,"sandboxCollectionData",this.renderingStateTracker.sandboxCollectionData);i(this,"sandboxVisibility",this.renderingStateTracker.sandboxVisibility);i(this,"selection",[]);i(this,"activeLocaleId");i(this,"rootFontSize");i(this,"inRelativeOverlayEditMode",!1);i(this,"shouldSetMinHeight",!1);i(this,"activeLinkStyle");i(this,"scopeIdToSelectedCollectionItem",new Map);i(this,"modulesRevision",null);i(this,"lazyModulesRevision",0);i(this,"componentHash",null);i(this,"loadedSomeUserData",!1);i(this,"initialLoadingOfScopesWasDone",new Set);i(this,"isInitialLoad",!0);i(this,"isDarkMode",!1);i(this,"scopeSwitchStartTime",0);i(this,"scopeSwitchUpdateEndTime",0);i(this,"scopeId","");i(this,"groundNodeMap");i(this,"groundNodes",[]);i(this,"groundNodeIdsInViewport",new Set);i(this,"visibleRect",{x:0,y:0,width:0,height:0});i(this,"nodeIdsToRerender",new Set);i(this,"lastPresetsListNodeUpdate",0);i(this,"trackScopeLoading",pe(e=>{if(this.scopeId!==e){c.reportError("CanvasSandboxApp: addScopeToLoadedDebounced called with different scopeId");return}this.renderingStateTracker.isLoading()||this.initialLoadingOfScopesWasDone.add(e)},J.isAutomation?0:300));i(this,"measureLayoutAndEmitUpdate",()=>{let e=performance.now(),t=this.lastRendering.update,r=this.measureLayout(t),o=this.sandboxCollectionData.export(),n=this.sandboxVisibility.export(),s=r.length;if(s===0&&o.dataUpdates.length===0&&o.itemIdsUpdates.length===0&&n.addedRenderIds.length===0&&n.removedRenderIds.length===0)return;c.trace("measureLayoutAndEmitUpdate","layoutMeasurementCount:",s,"collectionRecordUpdateCount:",o.dataUpdates.length,"collectionItemIdsUpdateCount:",o.itemIdsUpdates.length),this.updateTime+=performance.now()-e;let{updateTime:a,renderTime:l}=this.getAndResetTimings();this.trackScopeLoading(this.scopeId),this.renderedUpdateEmitter.emit({update:t,updateTime:a,renderTime:l,renderingPhase:this.deferredRendering.renderingPhase,moduleRuntimePhase:this.modulesRuntime.phase,isLoadingModules:this.isLoadingModules,layoutMeasurements:r,collectionUpdates:o,visibilityUpdates:n,scopeId:this.scopeId,updateEndTime:0,renderEndTime:0,scopeSwitchStartTime:0})});i(this,"deferredRenderingFinished",()=>{this.isLoadingResourcesPromise.resolve(),this.isInitialLoad=!1;let e=this.lastRendering.update,t=this.measureLayout(e);t.length>0&&c.trace("deferredRenderingFinished",t.length);let{updateTime:r,renderTime:o}=this.getAndResetTimings();this.renderedUpdateEmitter.emit({update:e,updateTime:r,renderTime:o,renderingPhase:"Normal",moduleRuntimePhase:this.modulesRuntime.phase,isLoadingModules:this.isLoadingModules,layoutMeasurements:t,collectionUpdates:this.sandboxCollectionData.export(),visibilityUpdates:this.sandboxVisibility.export(),scopeId:this.scopeId,updateEndTime:this.scopeSwitchUpdateEndTime,renderEndTime:performance.now(),scopeSwitchStartTime:this.scopeSwitchStartTime}),this.scopeSwitchStartTime&&this.scopeSwitchUpdateEndTime&&(this.scopeSwitchStartTime=0,this.scopeSwitchUpdateEndTime=0)});i(this,"deferredRendering",new B(e=>this.triggerRenderer(e),this.deferredRenderingFinished));i(this,"trackThumbnailLoad",(e,t)=>{let r=this.tree.get(e);if(!r)return;let o=this.tree.getGroundNodeFor(r);this.deferredRendering.trackResourceLoading(o.id,t)});i(this,"imageLoader",new gt(this.trackThumbnailLoad));i(this,"optimizedCanvasImageRenderer",new G(this.trackThumbnailLoad));i(this,"performanceMode",!1);i(this,"offsetX",0);i(this,"offsetY",0);i(this,"canvasZoom",1);i(this,"liveZoom");i(this,"inMoveTool",!1);i(this,"updateTime",0);i(this,"renderTime",0);i(this,"nodeWithPlaceholder",null);i(this,"previousNodeInTextEditor",Be);i(this,"previousNodesInEffectPreview",[]);i(this,"previousNodesInMoveToolRootFontSize",{});i(this,"previousActiveEffect",null);i(this,"previousActiveOverlayNodes",new Set);i(this,"controlsVisibilityService",new lt(this));i(this,"sandboxComponentLoaderService",new W);i(this,"sandboxComponentLoader",T);i(this,"layoutMeasureQueue",new H(this.measureLayoutAndEmitUpdate,this.renderingStateTracker));i(this,"modulesRuntime",new xt("waiting",this,()=>Ze(this.tree.root.locales??[],{includeDrafts:!0})));i(this,"forceRender",1e3);i(this,"assetMap",new Le);i(this,"svgRenderer",pt.shared());i(this,"remoteModuleStore");i(this,"remoteLoadedExternalModulesStore");i(this,"remoteRendererListener");i(this,"updateNodes",e=>{for(let t of e)this.nodeIdsToRerender.add(t);this.requestNodesRerender()});i(this,"rerenderCanvas",e=>{e!==null&&this.modulesRevision!==null&&e<this.modulesRevision&&c.reportError(new Error("Assertion error: processing modules update out of order.")),e!==null&&(this.modulesRevision=e),this.markGroundNodesNeedRendering(),this.rerenderGroundNodesIfNeeded()});i(this,"startedHeartbeat",!1);i(this,"emitHeartbeat",()=>{let t={},{memory:r}=performance;r&&(t.memoryTotal=r.totalJSHeapSize,t.memoryUsed=r.usedJSHeapSize,t.memoryLimit=r.jsHeapSizeLimit),t.domNodes=document.querySelectorAll("*").length,this.heartbeatEmitter.emit({vitals:t,next:1e4}),window.setTimeout(this.emitHeartbeat,1e4)});i(this,"requestNodesRerender",Ut(()=>{this.invalidateNodes(this.nodeIdsToRerender),this.nodeIdsToRerender.clear(),this.triggerRenderer()},250));i(this,"viewportSize",{width:800,height:800});i(this,"updateViewportSize",()=>{let e={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};return Ee(e,this.viewportSize)?!1:(this.viewportSize=e,!0)});i(this,"renderedUpdateEmitter",new N);i(this,"errorEmitter",new N);i(this,"heartbeatEmitter",new N);i(this,"previousCachedScopeId");i(this,"needsRender",!1);i(this,"lastRendering",{update:0,scopeId:"",zoom:1,offsetX:0,offsetY:0,tree:this.tree,groundNodesInViewport:new Set});i(this,"scheduledPostRenderMicroQueue",!1);me(this,C,[]);i(this,"reportError",e=>{this.errorEmitter.emit(e)});i(this,"isLoadingResourcesPromise",Y());i(this,"isTrackingUpdates",!1);i(this,"framerFontStore",new ft);i(this,"triggerRenderer",()=>{});this.renderingStateTracker.modulesRuntime=this.modulesRuntime;let e=new rt(h);e.setLocal(h.channels.renderer,this),e.setLocal(h.channels.assets,this),e.setLocal(h.channels.modules,this),e.setLocal(h.channels.modulesRuntime,this.modulesRuntime),e.setLocal(h.channels.controlsVisibility,this.controlsVisibilityService),e.setLocal(h.channels.flags,this),this.remoteRendererListener=e.getRemote(h.channels.rendererListener),this.remoteModuleStore=e.getRemote(h.channels.componentsStore),this.remoteLoadedExternalModulesStore=e.getRemote(h.channels.loadedExternalModulesStore);let t=he().app;u.isOn("newRpc")?(this.errorEmitter.setHook(r=>{this.remoteRendererListener.error(r)}),this.renderedUpdateEmitter.setHook(r=>{this.remoteRendererListener.renderedUpdate(r)}),this.heartbeatEmitter.setHook(r=>{this.remoteRendererListener.heartbeat(r)}),e.connect({url:t,allowDynamicTarget:!0}).then(()=>{let r=S(T.entities.values());this.remoteModuleStore.update(r,[],-1,-1)}).catch(reportError)):this.setupOldStyleRPC(),window.addEventListener("resize",this.updateViewportSize),setTimeout(this.updateViewportSize),window.addEventListener("visibilitychange",()=>{if(document.visibilityState!=="visible")return;this.updateViewportSize()&&(this.updateViewportRect(),this.updateGroundNodesInViewport(),this.triggerRenderer())})}get codeRevision(){return this.lazyModulesRevision<=0?this.componentHash+"_"+this.modulesRevision:this.componentHash+"_"+this.modulesRevision+"."+this.lazyModulesRevision}localModulesLoaded(e,t,r,o){this.modulesRevision=r,this.lazyModulesRevision=o,u.isOn("newRpc")?this.remoteModuleStore.update(S(e),t,r,o):this.sandboxComponentLoaderService.emitComponentLoaderUpdateEvent({type:"update",entities:S(e),deletedEntities:t,modulesRevision:r,lazyModulesRevision:o}),this.renderingStateTracker.updateState({componentLoaderHash:this.codeRevision}),this.renderedUpdateEmitter.emit({update:-1,updateTime:0,renderTime:0,renderingPhase:this.deferredRendering.renderingPhase,moduleRuntimePhase:this.modulesRuntime.phase,isLoadingModules:this.isLoadingModules,layoutMeasurements:[],collectionUpdates:this.sandboxCollectionData.export(),visibilityUpdates:this.sandboxVisibility.export(),scopeId:this.scopeId,updateEndTime:0,renderEndTime:0,scopeSwitchStartTime:0})}externalModulesLoadingStateChange(e){e||this.rerenderComponentPresets()}externalModuleLoaded(e,t){if(u.isOn("newRpc")){this.remoteLoadedExternalModulesStore.signalExternalModuleLoaded(e,S(t));return}this.sandboxComponentLoaderService.emitComponentLoaderUpdateEvent({type:"externalModuleLoaded",externalModuleBareIdentifier:e,entities:S(t)})}get isLoadingModules(){return this.initialLoadingOfScopesWasDone.has(this.scopeId)?!1:this.deferredRendering.renderingPhase!=="Normal"?!0:this.modulesRuntime.isLoadingAnything()||this.renderingStateTracker.isLoading()}get assetMapHash(){return this.assetMap.hash^this.forceRender}setupOldStyleRPC(){let e=!1,t=X.service.fingerprint,r=X.on(M).register({initialize:async({renderTarget:o,upgradeToMessagePortChannel:n,treeVersion:s})=>{if(this.renderTarget=o,e=n,s!==re)throw new Error("Incompatible tree version")}});this.setupExperimentsUpdatesStream(M),ve.interceptMessageEventsFromOpenerFrame(o=>{if(o.data!==t||!(o instanceof MessageEvent))return!1;r();let n=o.ports[0];b(n,"CanvasSandboxApp expected parent frame to transfer a MessagePort"),b(!this.channelToOpenerFrame,"CanvasSandboxApp already has a channel to the parent frame"),c.debug("CanvasSandboxApp: received port to parent frame; should use it to upgrade:",e);let s=e?new ge(n):M;return this.channelToOpenerFrame=s,u.isOn("newRpc")||(ye.on(s).register(this),Ne.on(s).register(this.sandboxComponentLoaderService),be.on(s).register(this.controlsVisibilityService),Ie.on(s).register(this.modulesRuntime),xe(Se.on(s).discover(),async a=>{a.assets&&this.updateAssets(a.assets)}),Te.on(s).discover().then(async a=>{a.moduleUpdatesStream().read(l=>this.updateModules(l.patches,l.prioritizedModules,l.dependentModules,l.initialized,l.revision)).catch(c.reportError)}).catch(c.reportError)),e&&this.setupExperimentsUpdatesStream(s),c.debug("CanvasSandboxApp: registered services"),!0}),_e.updateNodes=this.updateNodes,Je.updateNodes=this.updateNodes,Xe.updateNodes=this.updateNodes,Ke.updateNodes=this.updateNodes,et.updateNodes=this.updateNodes,c.debug("CanvasSandboxApp: ready to initialize"),it(M)}async updateModules(e,t,r,o,n){try{await(u.isOn("prioritizedModuleEvaluation")?this.handleModulesUpdate:this.legacyHandleModulesUpdate).call(this,{patches:e,prioritizedModules:t,dependentModules:r,initialized:o,revision:n,rerenderCanvas:this.rerenderCanvas})}catch(s){c.reportError(s,{context:"Failed to handle modules update"})}}updateAssets(e){this.assetMap.set(e),I.importCustomFonts(e,u.isOn("customFontImprovements")),this.triggerRenderer()}updateExperiments(e){c.trace("updateExperiments",e),u.update(e)}updateProjectFeatures(e){c.trace("updateProjectFeatures",e),V.update(e)}updateEmployeesOnlySettings(e){c.trace("updateEmployeesOnlySettings",e),A.update(e)}async handleModulesUpdate({patches:e,prioritizedModules:t,initialized:r,revision:o,rerenderCanvas:n,dependentModules:s}){if(t.length>0){let l=`Prioritize modules start ${o}`;if(P(l),await this.modulesRuntime.handleLocalModulesUpdate({patches:e,dependentModules:t,initialized:r,revision:o}),F(`Prioritize modules ${o}`,l),U(l),s.length===0){c.debug("No dependent modules to evaluate",o),n(o);return}n(null),e=[]}let a=`lowPriorityModules start ${o}`;P(a),this.modulesRuntime.handleLocalModulesUpdate({patches:e,dependentModules:s,initialized:r,revision:o}).catch(l=>c.reportError(l,{context:"Failed to handle modules update"})).finally(()=>{F(`lowPriorityModules ${o}`,a),U(a),n(o)})}async legacyHandleModulesUpdate({patches:e,prioritizedModules:t,initialized:r,revision:o,rerenderCanvas:n,dependentModules:s}){await this.modulesRuntime.handleLocalModulesUpdate({patches:e,dependentModules:t.concat(s),initialized:r,revision:o}),n(o)}setupExperimentsUpdatesStream(e){u.isOn("newRpc")||Re.on(e).discover().then(async t=>{t.experimentsUpdatesStream({replay:"latest"}).read(this.updateExperiments).catch(c.reportError),t.projectFeaturesUpdatesStream().read(this.updateProjectFeatures).catch(c.reportError)}).catch(c.reportError)}invalidateNodes(e){for(let t of e){let r=this.tree.get(t);r&&this.rerenderNode(r)}this.groundNodes=this.getGroundNodes(ie)}updateTransform(e){this.offsetX=e[0],this.offsetY=e[1],this.canvasZoom=e[2],this.liveZoom=e[3],this.inMoveTool=e[4]??!1}async waitForViewportSize(e){let t=Y(),r=()=>{window.innerWidth===e.width&&window.innerHeight===e.height&&t.resolve()};window.addEventListener("resize",r),r();try{await Promise.race([t,_t(5e3,`CanvasSandboxApp: expected resize to (${e.width}x${e.height}) within 5s, but viewport is still ${window.innerWidth}x${window.innerHeight}`)])}finally{window.removeEventListener("resize",r)}return{pixelRatio:window.devicePixelRatio}}updateViewportRect(){let e=this.liveZoom||this.canvasZoom,t=0,r=0,o=0,n=0;this.visibleRect={x:this.offsetX+t/e,y:this.offsetY+o/e,width:(this.viewportSize.width-t-r)/e,height:(this.viewportSize.height-o-n)/e}}updateGroundNodesInViewport(){if(this.liveZoom)return;let e=this.visibleRect,t=new Set,r=this.groundNodeIdsInViewport,o=this.groundNodes,n=!0;for(let a=0,l=o.length;a<l;a++){let m=o[a],f=m.id;Me.intersects($e(m),e)&&(t.add(f),n&&!r.has(f)&&(n=!1))}(!n||t.size!==r.size)&&(this.groundNodeIdsInViewport=t);let s=this.tree.getPresetsListNode();s&&s.update!==this.lastPresetsListNodeUpdate&&(this.lastPresetsListNodeUpdate=s.update,this.loadStylePresetFontsAndThenMeasure())}updateCache(){this.previousCachedScopeId=this.scopeId}markNeedsReactRendering(){this.needsRender=!0}markGroundNodesNeedRendering(){this.needsRender=!0,this.groundNodes=[]}rerenderNode(e){this.needsRender=!0,this.renderingStateTracker.updateAllRenderingsForNode(e)}setTree(e){this.tree=e,this.markGroundNodesNeedRendering()}_update(e){this.needsRender=!1,window.name=JSON.stringify(e.update),this.svgRenderer.update(),e.transform&&(this.updateTransform(e.transform),this.markNeedsReactRendering());let t=e.document??{};t.loadedAllUserData?(this.loadedSomeUserData=!0,this.renderTarget===K.export&&!A.isOn("disableLazyModuleLoading")?this.modulesRuntime.setEvaluationMode("lazy"):this.modulesRuntime.setEvaluationMode("eager")):t.loadedSomeUserData&&(this.loadedSomeUserData=!0,A.isOn("disableLazyModuleLoading")?this.modulesRuntime.setEvaluationMode("eager"):this.modulesRuntime.setEvaluationMode("lazy")),t.renderScope&&(this.scopeId!==t.renderScope&&this.trackScopeLoading.flush(),this.scopeId=t.renderScope,this.groundNodeMap=void 0,this.isInitialLoad||(this.scopeSwitchStartTime=performance.now()),this.markNeedsReactRendering()),t.renderNodes&&(this.scopeId="",this.groundNodeMap=t.renderNodes,this.markNeedsReactRendering()),t.activeLocaleId&&(this.activeLocaleId=t.activeLocaleId,this.markNeedsReactRendering());let r=t.partialTreeUpdate;if(r){this.partialTreeReceiver||(this.partialTreeReceiver=new Ct);let o=this.partialTreeReceiver.update(r);this.setTree(o),r.tree&&this.loadStylePresetFontsAndThenMeasure()}else{if(t.tree){c.debug("update",`took ${Date.now()-(t.timestamp||0)}ms to receive update`);let o=E.fromJS(t.tree,T)??void 0;if(o===void 0)throw Error("[Sandbox] Unable to build tree: "+t.tree);this.setTree(o),this.loadStylePresetFontsAndThenMeasure()}t.changes&&t.changes.length>0&&(tt(this.tree,t.changes),this.setTree(this.tree.commitDiffs()))}if(this.previousCachedScopeId!==this.scopeId&&this.markGroundNodesNeedRendering(),t.rootFontSize!==void 0&&this.rootFontSize!==t.rootFontSize&&(this.rootFontSize=t.rootFontSize??void 0,this.markNeedsReactRendering()),t.nodeInTextEditor!==void 0){if(this.previousNodeInTextEditor){let n=this.tree.get(this.previousNodeInTextEditor);n&&(n.cache.isEditable=!1,this.rerenderNode(n))}this.previousNodeInTextEditor=t.nodeInTextEditor;let o=this.tree.get(t.nodeInTextEditor);o&&(o.cache.isEditable=!0,this.rerenderNode(o))}if(t.nodesInEffectPreview!==void 0){if(this.previousNodesInEffectPreview){let s=new Set(t.nodesInEffectPreview);for(let a of this.previousNodesInEffectPreview){if(s.has(a))continue;let l=this.tree.get(a);l&&(l.cache.isEffectPreview=!1,l.cache.effectType=null,l.cache.effectIds=null,l.cache.webPageEffect=void 0,this.rerenderNode(l))}}this.previousActiveEffect=t.activeEffect??this.previousActiveEffect,this.previousNodesInEffectPreview=t.nodesInEffectPreview;let o=this.tree.get(this.scopeId),n=Ae(o);for(let s of t.nodesInEffectPreview){let a=this.tree.get(s);a&&(a.cache.isEffectPreview=!0,a.cache.effectType=t.activeEffect??this.previousActiveEffect,a.cache.effectIds=t.activeEffectIds??null,a.cache.webPageEffect=n,this.rerenderNode(a))}}if(t.nodesInMoveToolBaseFontSize!==void 0){if(this.previousNodesInMoveToolRootFontSize){let o={...t.nodesInMoveToolBaseFontSize};for(let n in this.previousNodesInMoveToolRootFontSize){if(n in o&&o[n]===this.previousNodesInMoveToolRootFontSize[n])continue;let s=this.tree.get(n);s&&(s.cache.rootFontSizeOverride=null,this.rerenderNode(s))}}this.previousNodesInMoveToolRootFontSize=t.nodesInMoveToolBaseFontSize;for(let o in t.nodesInMoveToolBaseFontSize){let n=this.tree.get(o);n&&(n.cache.rootFontSizeOverride=t.nodesInMoveToolBaseFontSize[o]??null,this.rerenderNode(n))}}if(t.activeOverlayNodes!==void 0){if(this.previousActiveOverlayNodes.size>0){let n=t.activeOverlayNodes;for(let s of this.previousActiveOverlayNodes){if(n.has(s))continue;let a=this.tree.get(s);a&&(ne(this.tree,a,!1),this.rerenderNode(a))}}t.activeOverlayNodes.size===0&&this.renderingStateTracker.clearEntriesByNodeRectMeasured(),this.previousActiveOverlayNodes=t.activeOverlayNodes;let o=!1;for(let n of t.activeOverlayNodes){let s=this.tree.get(n);s&&(ne(this.tree,s,!0),this.rerenderNode(s),o||=Qe(s))}o!==this.inRelativeOverlayEditMode&&(this.inRelativeOverlayEditMode=o,this.markNeedsReactRendering())}if(this.nodeWithPlaceholder&&t.placeholder!==void 0){let o=this.tree.get(this.nodeWithPlaceholder.id);this.nodeWithPlaceholder.cache.placeholders=null,this.nodeWithPlaceholder=null,o&&this.rerenderNode(o)}if(t.placeholder){let{id:o,placeholders:n}=t.placeholder,s=this.tree.get(o);s&&(this.nodeWithPlaceholder=s,s.cache.placeholders=n,this.rerenderNode(s))}typeof t.isReadyToRender=="boolean"&&this.deferredRendering.setReadyToRender(t.isReadyToRender),typeof t.isDarkMode=="boolean"&&(this.updateDarkMode(t.isDarkMode),this.markNeedsReactRendering()),typeof t.performanceMode=="boolean"&&(this.performanceMode=t.performanceMode,this.markNeedsReactRendering()),typeof t.shouldSetMinHeight=="boolean"&&(this.shouldSetMinHeight=t.shouldSetMinHeight,this.markNeedsReactRendering()),t.scopeIdToSelectedCollectionItem&&(this.scopeIdToSelectedCollectionItem=t.scopeIdToSelectedCollectionItem,this.markNeedsReactRendering()),t.activeLinkStyle!==void 0&&(this.activeLinkStyle=t.activeLinkStyle??void 0,this.markNeedsReactRendering()),this.needsRender&&this.rerenderGroundNodesIfNeeded()}updateGroundNodeOverflowSizes(e){for(let[t,r]of Object.entries(e)){let o=this.tree.get(t);o&&(o.cache.minX=r.minX,o.cache.maxX=r.maxX,o.cache.minY=r.minY,o.cache.maxY=r.maxY)}}updateDarkMode(e){this.isDarkMode!==e&&(this.isDarkMode=e,document.body.classList.toggle("framer-theme-dark",e),document.body.dataset.framerTheme=e?"dark":"light")}rerenderComponentPresets(){let e=this.tree.getPresetsListNode();if(!e)return;let t=e.getComponentPresets();for(let r of t){let o=r.cache;o.isComponentLoaded||!o.links||this.invalidateNodes(o.links)}this.rerenderGroundNodesIfNeeded()}rerenderGroundNodesIfNeeded(){let e=this.getGroundNodes(ie);Oe(this.groundNodes,e)||(this.groundNodes=e),c.trace("rerenderGroundNodesIfNeeded"),this.triggerRenderer()}beforeRendering(){this.renderingStateTracker.updateState({zoom:this.canvasZoom,assetHash:this.assetMapHash}),this.renderingStateTracker.updateGroundNodeIdsInViewport(this.groundNodeIdsInViewport),this.renderingStateTracker.signalChanges(this.groundNodes,this.tree.get(this.scopeId))}startRendering(){let e=performance.now();this.updateCache(),this.updateViewportRect(),this.updateGroundNodesInViewport(),this.loadedSomeUserData&&this.deferredRendering.setGroundNodes(this.groundNodes,this.groundNodeIdsInViewport,this.scopeId),this.lastRendering.zoom=this.canvasZoom,this.lastRendering.scopeId=this.scopeId,this.lastRendering.offsetX=this.offsetX,this.lastRendering.offsetY=this.offsetY,this.lastRendering.tree=this.tree,this.lastRendering.groundNodesInViewport=this.groundNodeIdsInViewport,this.lastRendering.update=this.lastEngineUpdate;let t=performance.now();this.updateTime+=t-e,c.trace("startRendering: zoom",this.canvasZoom,"scroll",this.offsetX,this.offsetY,"rendering phase",this.deferredRendering.renderingPhase,"liveZoom",!!this.liveZoom),!this.scheduledPostRenderMicroQueue&&(this.scheduledPostRenderMicroQueue=!0,queueMicrotask(()=>{this.scheduledPostRenderMicroQueue=!1,this.renderTime+=performance.now()-t,this.measureLayoutAndEmitUpdate()}))}measureLayout(e){if(this.liveZoom)return[];if(this.previousNodesInEffectPreview.length>0)return[];P("LayoutMeasure");let t=this.layoutMeasureQueue.process(this.lastRendering);return F(`LayoutMeasure ${e}`,"LayoutMeasure"),U("LayoutMeasure"),t}getGroundNodes(e){let t=this.tree;if(this.scopeId){let o=t.get(this.scopeId);return b(o instanceof je,"Can't find active page in tree"),o.getGroundNodes(e)}let r=[];if(this.groundNodeMap)for(let o in this.groundNodeMap){let n=t.get(o);if(!n)continue;let s=this.groundNodeMap[o];if(!s)continue;let a=st(t,n,s,this.isDarkMode,this.previousActiveOverlayNodes);r.push(a)}return r}command({command:e,args:t}){e==="clearCache"?(this.forceRender+=1,this.tree.resetDraftNodesAndCache(),this.setTree(this.tree)):e==="setEnvironment"&&z(t)?Object.assign(J,t):e==="setLogLevel"&&ke(t)?fe(t,!1):e==="renderingFeatures"&&z(t)?Et(t,this.renderingStateTracker):e==="updateGroundNodeOverflowSizes"&&z(t)?this.updateGroundNodeOverflowSizes(t):c.warn("unknown command:",e,t)}getAndResetTimings(){let e=this.updateTime,t=this.renderTime;return this.updateTime=0,this.renderTime=0,{updateTime:e,renderTime:t}}initialize(e,t){if(e!==re)throw new Error("Incompatible tree version");return this.renderTarget=t,Promise.resolve()}updateSandbox(e){return this.update({fixmeOpaqueJSON:e})}update({fixmeOpaqueJSON:e}){P("sandbox");let t=this.scopeId;this.startedHeartbeat||(c.debug("Starting heartbeat"),this.startedHeartbeat=!0,setTimeout(this.emitHeartbeat));let r=performance.now(),o=!1,n=-1;Mt(e)?(n=e.update,this.lastEngineUpdate=e.update,this._update(e),o=!0):nt(e)&&this.command(e);let s=this.deferredRendering.renderingPhase;this.updateTime+=performance.now()-r,t!==this.scopeId&&!this.isInitialLoad&&(this.scopeSwitchUpdateEndTime=performance.now());let{updateTime:a,renderTime:l}=this.getAndResetTimings();return this.renderedUpdateEmitter.emit({update:n,updateTime:a,renderTime:l,renderingPhase:s,moduleRuntimePhase:this.modulesRuntime.phase,isLoadingModules:this.isLoadingModules,layoutMeasurements:[],collectionUpdates:this.sandboxCollectionData.export(),visibilityUpdates:this.sandboxVisibility.export(),scopeId:this.scopeId??"",updateEndTime:0,renderEndTime:0,scopeSwitchStartTime:0}),Pe(),F("Sandbox "+n,"sandbox"),U("sandbox"),at(),Z(this,C).forEach(m=>m()),ue(this,C,[]),o}runAfterNextUpdate(e){Z(this,C).push(e)}renderedUpdateStream(e){return this.renderedUpdateEmitter.newStream(e)}loadStylePresetFontsAndThenMeasure(){let e=this.tree.getPresetsListNode();if(!e)return;let t=[];for(let r of e.children){if(Ve(r))continue;let o=r.getFontsForCodeGeneration();for(let n of o)I.isSelectorLoaded(n)||t.push(n)}t.length>0?I.loadFonts(t).then(()=>this.layoutMeasureQueue.stylePresetChanged(this.tree)).catch(_):this.layoutMeasureQueue.stylePresetChanged(this.tree)}async waitUntilFontsLoaded(){let e=this.getGroundNodes(),t=[];for(let o of e)for(let n of o.walk())Lt(n)&&n.hasFontsToLoad()&&t.push(n);let r=new Set;try{await Promise.allSettled(t.map(o=>{let n=o.getFontsForLoading();return I.loadFonts(n).then(({newlyLoadedFontCount:s})=>{s>0&&r.add(o.id)}).catch(_)}))}catch{}for(let o of this.nodeIdsToRerender)r.add(o);this.invalidateNodes(r),this.nodeIdsToRerender.clear(),await new Promise(o=>{this.triggerRenderer(o)})}errorStream(e){return this.errorEmitter.newStream(e)}heartbeatStream(e){return this.heartbeatEmitter.newStream(e)}async waitUntilResourcesLoaded(){await this.isLoadingResourcesPromise}assertTrackingUpdates(e){b(e===this.isTrackingUpdates,"Update tracking (willStartUpdates/waitForCompleteRenderAfterUpdates) must be balanced and not nested")}async willStartUpdates(){this.assertTrackingUpdates(!1),this.isTrackingUpdates=!0}async waitForCompleteRenderAfterUpdates(){this.assertTrackingUpdates(!0),await this.waitUntilResourcesLoaded(),await this.waitUntilPlaceholdersSettled(),await this.waitUntilFontsLoaded(),await this.renderingStateTrackerNotLoading(),await this.renderingQueuesDrained(),await Promise.race([Q(10),At(1e4,"CanvasSandboxApp: didn\u2019t render after 10s")]).finally(()=>{this.isTrackingUpdates=!1})}async waitUntilAllFetchesAreDone(){for(;this.renderingStateTracker.isLoading()||this.renderingStateTracker.isWaitingForFetchValueToResolve()||this.renderingStateTracker.isWaitingForCollections()||this.renderingStateTracker.isWaitingForLayoutTemplates()||this.renderingStateTracker.isWaitingForModules();)await Q()}async renderingStateTrackerNotLoading(){await Promise.race([this.waitUntilAllFetchesAreDone(),At(1e4,"CanvasSandboxApp: didn\u2019t fetch all data after 10s")])}async renderingQueuesDrained(){await Q();for(let e=0;e<100;e++){if(!g.hasImmediateTasksToRun())return;await Q()}}async preloadFonts({selectors:e}){await I.loadFonts(e)}async getFitTextViewBoxes({ids:e,update:t}){for(;this.lastEngineUpdate<t;)await new Promise(o=>this.runAfterNextUpdate(o));let r=[];for(let o of this.tree.getNodesWithTrait(Object.keys(e),ee))ee(o)&&r.push(...o.getFontsForLoading());return await I.loadFonts(r),Ot(this.tree,e)}async fetchJSON({url:e}){let t=await fetch(e,{credentials:"omit"});if(!t.ok)throw new Error("Invalid HTTP Status Code: "+t.status);let r=await t.json();return{status:t.status,data:{json:r}}}async getComponentRenderingError(e){let t=this.renderingStateTracker.getRenderingErrorForNode(e.nodeId);return t?{type:"ComponentRenderingError",message:t.message}:{type:"None"}}async measureNodes({ids:e}){if(this.previousNodesInEffectPreview.length>0)return{measurements:[]};let t=this.tree.getNodes(e),r=kt(t).process({scopeId:this.scopeId,zoom:this.canvasZoom,offsetX:this.offsetX,offsetY:this.offsetY,tree:this.tree,groundNodesInViewport:this.groundNodeIdsInViewport});return c.trace("measureNodes:",r.length),{measurements:r}}async waitUntilPlaceholdersSettled(){return Ue()}async queryData(e){return this.sandboxComponentLoaderService.queryData(e)}};C=new WeakMap;var j=v(D());we({name:"canvas",security:{allowChannelToOpenerWithOrigin:ot(document.referrer).origin}});R("app").info("Framer Sandbox Starting",{type:"production",version:"612a550"});var Vt=R("canvas-sandbox"),p=new q;Object.assign(window,{Framer:te,sandboxApp:p});Vt.debug({assetMap:p.assetMap});var Yt=ht(p.assetMap);ze({assetResolver:Yt,fetchGoogleFontsList:bt,fetchFontshareFontsList:yt,fetchBuiltInFontsList:vt,enableFontStore:!0,executionTimeBudgets:{frame:500,component:150},queueMeasureRequest(...d){p.layoutMeasureQueue.add(...d)},experiments:u,projectFeatures:V,useImageSource:p.imageLoader.useImageSource,useImageElement:p.imageLoader.useImageElement,canRenderOptimizedCanvasImage:p.optimizedCanvasImageRenderer.canRenderCanvasImage,renderOptimizedCanvasImage:p.optimizedCanvasImageRenderer.renderCanvasImage,getLogger(d){return Vt.extend(d)}});var Xt=()=>{let[d,e]=$.default.useState(0),t=wt();return p.triggerRenderer=r=>{r&&t.add(r),p.beforeRendering(),e(d+1)},$.default.useEffect(()=>{for(let r of t)t.delete(r),r()}),p.startRendering(),p};St((0,j.jsx)($.default.StrictMode,{children:(0,j.jsx)(It.Provider,{value:p.modulesRuntime,children:(0,j.jsx)(Nt,{useState:Xt})})}),document.querySelector("main"));
//# sourceMappingURL=https://app.framerstatic.com/canvas-sandbox.WGMGZIRZ.mjs.map
